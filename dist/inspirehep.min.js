/*
 * This file is part of INSPIRE.
 * Copyright (C) 2016 CERN.
 *
 * INSPIRE is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of the
 * License, or (at your option) any later version.
 *
 * INSPIRE is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with INSPIRE; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
 *
 * In applying this license, CERN does not
 * waive the privileges and immunities granted to it by virtue of its status
 * as an Intergovernmental Organization or submit itself to any jurisdiction.
 */
!function(e){e.module("inspirehep",["export","checkbox"])}(angular),function(e){e.module("checkbox",["checkbox.controllers","checkbox.services"])}(angular),function(e){e.module("export",["ngclipboard","ngSanitize","ui.bootstrap","export.controllers","export.directives","export.services"]),e.module("export").config(["$uibTooltipProvider",function(e){e.setTriggers({click:"mouseleave"})}])}(angular),function(e){function t(t,o){function r(e){o.toggleIdToExport(e)}function n(){var r=c();e.forEach(t.$parent.vm.invenioSearchResults.hits.hits,function(e){r?o.removeIdFromExport(e.id):o.addIdToExport(e.id)})}function a(e){return-1!==o.getIdsToExport().indexOf(e)}function c(){return t.$parent.vm.invenioSearchResults.hits?t.$parent.vm.invenioSearchResults.hits.hits.length===o.getIdsToExport().length:!1}function i(){return o.getIdsToExport().length>0}function l(){o.resetRecids()}t.toggleId=r,t.toggleAllIds=n,t.isChecked=a,t.allChecked=c,t.anyChecked=i,t.$on("invenio.search.success",l)}t.$inject=["$scope","exportRecords"],e.module("checkbox.controllers",[]).controller("checkboxCtrl",t)}(angular),function(e){function t(){function e(e){return l.indexOf(e)}function t(e,t){-1===e&&l.push(t)}function o(e){e>-1&&l.splice(e,1)}function r(o){var r=e(o);t(r,o)}function n(t){var r=e(t);o(r,t)}function a(r){var n=e(r);n>-1?o(n,r):t(n,r)}function c(){return l}function i(){l=[]}var l=[],u={addIdToExport:r,removeIdFromExport:n,toggleIdToExport:a,getIdsToExport:c,resetRecids:i};return u}e.module("checkbox.services",[]).service("exportRecords",t)}(angular),function(e){function t(t,o,r,n,a){function c(){d.loadFormat()}function i(){o.close()}function l(e){d.exportContent="",d.exportFormat=e}function u(){var t=(new Blob([d.exportContent],{type:"text/plain"}),"text/plain;charset=utf-8,"+encodeURIComponent(d.exportContent)),o=e.element('<a id="data-download" href="data:'+t+'" download="'+d.exportFormat+"."+d.formats[d.exportFormat]+'">download</a>');o[0].click()}function p(e,t){e!==t&&d.loadFormat()}function s(){function o(e){d.exportContent=e.data}function a(){console.log("Error request")}function c(){d.loading=!1}d.loading=!0;var i=[];d.recid?i.push(d.recid):i=n.getIdsToExport();var l={};void 0===t.$parent.vm?l={method:"GET",params:{q:""},url:"/api/literature/"}:e.copy(t.$parent.vm.invenioSearchCurrentArgs,l),r.getFormat(l,d.exportFormat,i).then(o,a).finally(c)}var d=this;d.formats={BibTex:"bib","LaTex(EU)":"tex","LaTex(US)":"tex","CV format (LaTex)":"tex","CV format (html)":"html","CV format (text)":"txt"},d.recid=a,d.exportContent=null,d.loading=!1,d.exportFormat="BibTex",d.changeFormat=l,d.closeModal=i,d.loadFormat=s,d.downloadFormat=u,c(),t.$watch("vm.exportFormat",p)}t.$inject=["$scope","$uibModalInstance","exportAPI","exportRecords","recid"],e.module("export.controllers",[]).controller("exportModalInstanceCtrl",t)}(angular),function(e){function t(e){function t(t,o,r){t.openModal=function(t){e.open({animation:!0,templateUrl:r.bodyTemplate,size:t,controller:"exportModalInstanceCtrl",controllerAs:"vm",resolve:{recid:function(){return r.recid}}})}}function o(e,t){return t.buttonTemplate}return{templateUrl:o,restrict:"E",scope:!1,link:t}}t.$inject=["$uibModal"],e.module("export.directives",[]).directive("inspireExportModal",t)}(angular),function(e){function t(t){function o(o,r,n){var a=[];switch(delete o.params.page,e.forEach(n,function(e){a.push("control_number:"+e)}),o.params.q=a.join(" OR "),r){case"BibTex":o.headers={Accept:"application/x-bibtex"};break;case"LaTex(EU)":o.headers={Accept:"application/x-latexeu"};break;case"LaTex(US)":o.headers={Accept:"application/x-latexus"};break;case"CV format (LaTex)":o.headers={Accept:"application/x-cvformatlatex"};break;case"CV format (html)":o.headers={Accept:"application/x-cvformathtml"};break;case"CV format (text)":o.headers={Accept:"application/x-cvformattext"}}return t(o)}var r={getFormat:o};return r}t.$inject=["$http"],e.module("export.services",[]).service("exportAPI",t)}(angular);