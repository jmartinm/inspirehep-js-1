/*
 * This file is part of INSPIRE.
 * Copyright (C) 2016 CERN.
 *
 * INSPIRE is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of the
 * License, or (at your option) any later version.
 *
 * INSPIRE is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with INSPIRE; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
 *
 * In applying this license, CERN does not
 * waive the privileges and immunities granted to it by virtue of its status
 * as an Intergovernmental Organization or submit itself to any jurisdiction.
 */
!function(t){t.module("inspirehep",["export","checkbox"])}(angular),function(t){t.module("checkbox",["checkbox.controllers","checkbox.services"])}(angular),function(t){t.module("export",["ngclipboard","ngSanitize","ui.bootstrap","export.controllers","export.directives","export.services"]),t.module("export").config(["$uibTooltipProvider",function(t){t.setTriggers({click:"mouseleave"})}])}(angular),function(t){function e(e,o){function r(t){o.toggleIdToExport(t)}function n(){var r=c();t.forEach(e.$parent.vm.invenioSearchResults.hits.hits,function(t){r?o.removeIdFromExport(t.id):o.addIdToExport(t.id)})}function a(t){return-1!==o.getIdsToExport().indexOf(t)}function c(){return e.$parent.vm.invenioSearchResults.hits?e.$parent.vm.invenioSearchResults.hits.hits.length===o.getIdsToExport().length:!1}function i(){return o.getIdsToExport().length>0}e.toggleId=r,e.toggleAllIds=n,e.isChecked=a,e.allChecked=c,e.anyChecked=i}e.$inject=["$scope","exportRecords"],t.module("checkbox.controllers",[]).controller("checkboxCtrl",e)}(angular),function(t){function e(){function t(t){return i.indexOf(t)}function e(t,e){-1===t&&i.push(e)}function o(t){t>-1&&i.splice(t,1)}function r(o){var r=t(o);e(r,o)}function n(e){var r=t(e);o(r,e)}function a(r){var n=t(r);n>-1?o(n,r):e(n,r)}function c(){return i}var i=[],l={addIdToExport:r,removeIdFromExport:n,toggleIdToExport:a,getIdsToExport:c};return l}t.module("checkbox.services",[]).service("exportRecords",e)}(angular),function(t){function e(e,o,r,n,a){function c(){d.loadFormat()}function i(){o.close()}function l(t){d.exportContent="",d.exportFormat=t}function u(){var e=(new Blob([d.exportContent],{type:"text/plain"}),"text/plain;charset=utf-8,"+encodeURIComponent(d.exportContent)),o=t.element('<a id="data-download" href="data:'+e+'" download="'+d.exportFormat+"."+d.formats[d.exportFormat]+'">download</a>');o[0].click()}function p(t,e){t!==e&&d.loadFormat()}function s(){function t(t){d.exportContent=t.data}function o(){console.log("Error request")}function a(){d.loading=!1}d.loading=!0;var c=[];d.recid?c.push(d.recid):c=n.getIdsToExport();var i=e.$parent.vm.invenioSearchCurrentArgs;r.getFormat(i,d.exportFormat,c).then(t,o).finally(a)}var d=this;d.formats={BibTex:"bib","LaTex(EU)":"tex","LaTex(US)":"tex","CV format (LaTex)":"tex","CV format (html)":"html","CV format (text)":"txt"},d.recid=a,d.exportContent=null,d.loading=!1,d.exportFormat="BibTex",d.changeFormat=l,d.closeModal=i,d.loadFormat=s,d.downloadFormat=u,c(),e.$watch("vm.exportFormat",p)}e.$inject=["$scope","$uibModalInstance","exportAPI","exportRecords","recid"],t.module("export.controllers",[]).controller("exportModalInstanceCtrl",e)}(angular),function(t){function e(t){function e(e,o,r){e.openModal=function(e){t.open({animation:!0,templateUrl:r.bodyTemplate,size:e,controller:"exportModalInstanceCtrl",controllerAs:"vm",resolve:{recid:function(){return r.recid}}})}}function o(t,e){return e.buttonTemplate}return{templateUrl:o,restrict:"E",scope:!1,link:e}}e.$inject=["$uibModal"],t.module("export.directives",[]).directive("inspireExportModal",e)}(angular),function(t){function e(e){function o(o,r,n){var a=[];switch(t.forEach(n,function(t){a.push("control_number:"+t)}),o.params.q=a.join(" OR "),r){case"BibTex":o.headers={Accept:"application/x-bibtex"};break;case"LaTex(EU)":o.headers={Accept:"application/x-latexeu"};break;case"LaTex(US)":o.headers={Accept:"application/x-latexus"};break;case"CV format (LaTex)":o.headers={Accept:"application/x-cvformatlatex"};break;case"CV format (html)":o.headers={Accept:"application/x-cvformathtml"};break;case"CV format (text)":o.headers={Accept:"application/x-cvformattext"}}return e(o)}var r={getFormat:o};return r}e.$inject=["$http"],t.module("export.services",[]).service("exportAPI",e)}(angular);